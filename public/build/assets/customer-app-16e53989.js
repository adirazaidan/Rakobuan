import"./bootstrap-b7f67058.js";document.addEventListener("DOMContentLoaded",function(){console.log("DOMContentLoaded event fired");const j=document.querySelector('meta[name="csrf-token"]')?document.querySelector('meta[name="csrf-token"]').getAttribute("content"):null,k=document.getElementById("searchInput"),M=document.getElementById("categoryFilterDropdown"),P=document.querySelectorAll(".filter-price-buttons button"),h=document.getElementById("bestsellerFilter"),b=document.getElementById("discountFilter"),I=document.getElementById("menu-list"),K=document.querySelectorAll(".product-card"),C=document.getElementById("customAlertModal"),me=document.getElementById("alertModalTitle"),pe=document.getElementById("alertModalMessage"),D=document.getElementById("alertModalIcon"),U=document.getElementById("closeAlertModalBtn"),Q=document.getElementById("alertModalConfirmBtn");window.customAlert=function(e,n="info",t="Pesan"){if(C){switch(me.textContent=t,pe.textContent=e,D.className="fas",n){case"success":D.classList.add("fa-check-circle","alert-success");break;case"warning":D.classList.add("fa-exclamation-triangle","alert-warning");break;case"danger":case"error":D.classList.add("fa-times-circle","alert-danger");break;case"info":default:D.classList.add("fa-info-circle","alert-info");break}C.className="modal-overlay",C.classList.add(`alert-${n}`),C.style.display="flex"}};const G=()=>{C&&(C.style.display="none",C.classList.remove("alert-success","alert-warning","alert-danger","alert-info"))};if(U&&U.addEventListener("click",G),Q&&Q.addEventListener("click",G),C&&C.addEventListener("click",e=>{e.target===C&&G()}),window.alert=function(e){customAlert(e,"info","Pesan")},window.confirm=function(e){return new Promise(n=>{const t=document.createElement("div");t.className="modal-overlay",t.style.display="flex",t.innerHTML=`
                <div class="modal-content">
                    <div class="modal-header">
                        <h4>Konfirmasi</h4>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="alert-icon-wrapper">
                            <i class="fas fa-question-circle" style="color: var(--warning-color);"></i>
                        </div>
                        <p class="alert-message">${e}</p>
                        <div class="alert-actions">
                            <button class="btn btn-secondary" id="cancelBtn">Batal</button>
                            <button class="btn btn-primary" id="confirmBtn">Ya</button>
                        </div>
                    </div>
                </div>
            `;const s=o=>{document.body.removeChild(t),n(o)};document.body.appendChild(t),t.querySelector("#cancelBtn").addEventListener("click",()=>s(!1)),t.querySelector("#confirmBtn").addEventListener("click",()=>s(!0)),t.querySelector(".modal-close").addEventListener("click",()=>s(!1)),t.addEventListener("click",o=>{o.target===t&&s(!1)})})},window.showLogoutConfirm=function(){confirm("Apakah Anda yakin ingin keluar dari meja ini?").then(e=>{e&&document.getElementById("logout-form").submit()})},k&&I){let n=function(){console.log("filterAndSortProducts called");const s=k.value.toLowerCase(),o=M?M.value:"all",a=h?h.checked:!1,c=b?b.checked:!1;console.log("Filter values:",{searchTerm:s,selectedCategory:o,isBestsellerChecked:a,isDiscountChecked:c,currentPriceSortOrder:e});const l=Array.from(K);let i=l.filter(r=>{const m=r.getAttribute("data-product-name")||"",p=r.getAttribute("data-category-id")||"",u=r.getAttribute("data-is-bestseller")==="true",y=r.getAttribute("data-has-discount")==="true";return m.includes(s)&&(o==="all"||p===o)&&(!a||u)&&(!c||y)});e&&i.sort((r,m)=>{const p=parseFloat(r.getAttribute("data-price"))||0,u=parseFloat(m.getAttribute("data-price"))||0;return e==="asc"?p-u:u-p});const d=l.some(r=>r.getAttribute("data-is-bestseller")==="true"),f=l.some(r=>r.getAttribute("data-has-discount")==="true");t(d,f),I.innerHTML="",i.length>0?i.forEach(r=>{I.appendChild(r),r.style.display="block"}):I.innerHTML='<p style="padding: 0 1.5rem;">Tidak ada menu yang sesuai dengan filter yang dipilih.</p>'},t=function(s,o){if(!h||!b)return;const a=h.nextElementSibling,c=b.nextElementSibling;s?(h.disabled=!1,a&&(a.textContent="Terlaris",a.style.color="")):(h.disabled=!0,h.checked=!1,a&&(a.textContent="Terlaris (belum ada)",a.style.color="var(--gray-500)")),o?(b.disabled=!1,c&&(c.textContent="Diskon",c.style.color="")):(b.disabled=!0,b.checked=!1,c&&(c.textContent="Diskon (belum ada)",c.style.color="var(--gray-500)"))};console.log("Menu filtering elements found, initializing filters"),console.log("searchInput:",k),console.log("menuGrid:",I),console.log("categoryFilterDropdown:",M),console.log("priceFilterButtons:",P),console.log("bestsellerFilter:",h),console.log("discountFilter:",b),console.log("allProductCards:",K);let e=null;k&&(k.addEventListener("input",n),console.log("Search input listener added")),M&&(M.addEventListener("change",n),console.log("Category dropdown listener added")),h&&(h.addEventListener("change",n),console.log("Bestseller filter listener added")),b&&(b.addEventListener("change",n),console.log("Discount filter listener added")),P.length>0&&(P.forEach(s=>{s.addEventListener("click",function(){const o=this.getAttribute("data-sort-order");P.forEach(a=>{a.classList.remove("active"),a.style.transform=""}),e===o?e=null:(e=o,this.classList.add("active"),this.style.transform="scale(1.1)"),n()})}),console.log("Price filter buttons listeners added")),n()}else console.log("Menu filtering elements not found, skipping filter initialization");const z=document.getElementById("customerMenuToggle"),F=document.querySelector(".sidebar-customer");let E=document.querySelector(".sidebar-overlay");E||(E=document.createElement("div"),E.className="sidebar-overlay",document.body.appendChild(E));const fe=()=>{F&&F.classList.add("open"),E&&E.classList.add("active")},ye=()=>{F&&F.classList.remove("open"),E&&E.classList.remove("active")};z&&z.addEventListener("click",fe),E&&E.addEventListener("click",ye);const L=document.getElementById("imageLightbox"),X=document.getElementById("lightboxImage"),J=e=>{L&&X&&e&&(X.src=e,L.style.display="flex")},Y=()=>{L&&(L.style.display="none")};if(L){const e=document.querySelector(".lightbox-close");e&&e.addEventListener("click",Y),L.addEventListener("click",n=>{n.target===L&&Y()})}const $=document.getElementById("descriptionModal"),ge=document.getElementById("descriptionModalTitle"),he=document.getElementById("descriptionModalText"),V=document.getElementById("closeDescriptionModalBtn"),be=(e,n)=>{$&&(ge.textContent=e,he.textContent=n,$.style.display="flex")},Z=()=>{const e=document.getElementById("descriptionModal");e&&(e.style.display="none")},v=document.getElementById("paymentModal"),ee=document.getElementById("paymentBtn"),te=document.getElementById("closePaymentModalBtn"),ne=document.getElementById("callWaiterFromPayment"),Ce=()=>{v&&(v.style.display="flex",v.style.opacity="0",setTimeout(()=>{v.style.opacity="1"},10))},H=()=>{v&&(v.style.opacity="0",setTimeout(()=>{v.style.display="none"},300))};ee&&ee.addEventListener("click",Ce),te&&te.addEventListener("click",H),ne&&ne.addEventListener("click",()=>{H();const e=document.querySelector(".call-waiter-btn");e&&e.click()}),v&&v.addEventListener("click",e=>{e.target===v&&H()}),V&&V.addEventListener("click",Z),$&&$.addEventListener("click",e=>{e.target===$&&Z()});const Ee=document.getElementById("cancelOrderModal"),ve=document.getElementById("modalOrderNumber");document.querySelectorAll(".btn-cancel-top-right").forEach(e=>{e.addEventListener("click",function(){const n=this.dataset.orderNumber;ve.textContent=n,Ee.style.display="flex"})}),document.querySelectorAll(".modal-close").forEach(e=>{e.addEventListener("click",function(){const n=this.closest(".modal-overlay");n&&(n.style.display="none")})}),document.querySelectorAll(".modal-overlay").forEach(e=>{e.addEventListener("click",function(n){n.target===this&&(this.style.display="none")})});const q=(e,n)=>{const t=document.getElementById("mini-cart-bar"),s=document.getElementById("mini-cart-item-count"),o=document.getElementById("mini-cart-total-price"),a=document.getElementById("cart-items-list");if(!t||!s||!o)return;if(a){t.classList.remove("show");return}const c=document.querySelector(".menu-page-container");if(e>0){if(s.textContent=`${e} Item`,o.textContent="Rp "+n.toLocaleString("id-ID"),t.classList.add("show"),c){const l=t.offsetHeight;c.style.paddingBottom=`${l+20}px`}}else t.classList.remove("show"),c&&(c.style.paddingBottom="2rem")},x=(e,n,t=null,s=!1)=>{const o=t===null||t.trim()===""?"-":t,a=new FormData;a.append("product_id",e),a.append("quantity",n),o!==null&&a.append("notes",o);let c=`/cart/update/${e}`,l="POST";return a.append("_method","PATCH"),s&&(c="/cart/add",a.delete("_method")),fetch(c,{method:l,headers:{"X-CSRF-TOKEN":j,Accept:"application/json"},body:a}).then(i=>i.json())},oe=e=>{const n=new FormData;return n.append("_method","DELETE"),fetch(`/cart/remove/${e}`,{method:"POST",headers:{"X-CSRF-TOKEN":j,Accept:"application/json"},body:n}).then(t=>t.json())},T=(e,n)=>{const t=e.querySelector(".inline-stock-feedback");t&&(t.textContent=n,t.classList.add("show"),setTimeout(()=>{t.classList.remove("show")},2500))},w=document.getElementById("notesModal"),_=document.getElementById("notesForm"),se=document.getElementById("closeNotesModalBtn"),ae=(e,n,t)=>{w&&(document.getElementById("notesModalProductId").value=e,document.getElementById("notesModalProductName").textContent=n,document.getElementById("notesModalTextArea").value=t||"",w.style.display="flex")},R=()=>{w&&(w.style.display="none")};if(se&&se.addEventListener("click",R),w&&w.addEventListener("click",e=>{e.target===w&&R()}),_&&_.addEventListener("submit",async e=>{e.preventDefault();const n=document.getElementById("notesModalProductId").value,t=document.getElementById("notesModalTextArea").value;let s=document.getElementById(`product-card-${n}`)||document.getElementById(`cart-item-${n}`);if(!s)return;const o=s.querySelector(".quantity-inline-display");if(!o)return;const a=o.textContent,c=_.querySelector('button[type="submit"]');if(c.textContent="Menyimpan...",c.disabled=!0,(await x(n,a,t)).success){const i=s.querySelector(".btn-edit-notes");i&&(i.dataset.notes=t,t&&t.trim()!==""?i.classList.add("has-notes"):i.classList.remove("has-notes"));const d=s.querySelector(".item-notes-text");d&&(d.textContent=t||"-"),R()}else customAlert("Gagal menyimpan catatan.","danger","Error");c.textContent="Simpan Catatan",c.disabled=!1}),I){const e=(s,o)=>{const a=document.getElementById(`product-card-${s}`);if(!a)return;const c=a.querySelector(".cart-action-wrapper"),l=a.querySelector(".btn-edit-notes"),i=a.dataset,d=parseInt(i.stock);if(o>0){const f=o>=d;c.innerHTML=`<div class="quantity-selector-inline" data-product-id="${s}"><button class="btn-quantity-inline btn-decrease-inline">-</button><span class="quantity-inline-display">${o}</span><button class="btn-quantity-inline btn-increase-inline" ${f?"disabled":""}>+</button></div>`,l&&(l.style.display="block")}else{const r=!(i.isAvailable==="true")||d<=0;c.innerHTML=`<button class="btn-add-cart-initial" data-product-id="${s}" ${r?"disabled":""} title="Tambah ke Keranjang"><i class="fas fa-shopping-cart"></i></button>`,l&&(l.style.display="none")}};I.addEventListener("click",async s=>{const o=s.target,a=o.closest(".btn-read-more"),c=o.closest(".btn-add-cart-initial"),l=o.closest(".btn-increase-inline"),i=o.closest(".btn-decrease-inline"),d=o.closest(".btn-edit-notes"),f=o.closest(".card-zoom-btn");if(a){const r=a.dataset.productId,m=document.getElementById(`product-card-${r}`);if(m){const p=m.querySelector(".product-name").textContent,u=m.querySelector(".product-description").dataset.fullDescription;be(p,u)}}else if(c){c.disabled=!0,c.textContent="...";const r=c.dataset.productId,m=c.closest(".product-card"),p=parseInt(m.dataset.stock);try{const u=await x(r,1,"",!0);u.success?(e(r,1),q(u.cartCount,u.grandTotal),p<=1&&T(m,`Stok tersisa ${p}`)):(customAlert(u.message||"Gagal menambahkan item.","danger","Error"),e(r,0))}catch(u){console.error("Cart action failed:",u),customAlert("Terjadi kesalahan jaringan. Gagal menambahkan item.","danger","Error Jaringan"),e(r,0)}finally{c.disabled=!1,c.innerHTML='<i class="fas fa-shopping-cart"></i>'}}else if(l){l.disabled=!0;const r=l.closest(".product-card"),m=parseInt(r.dataset.stock),p=l.closest(".quantity-selector-inline"),u=p.querySelector(".quantity-inline-display");let y=parseInt(u.textContent);if(y>=m){p.classList.add("shake"),setTimeout(()=>p.classList.remove("shake"),500),T(r,`Stok tersisa ${m}`),l.disabled=!0;return}let B=y+1;u.textContent="...";try{const S=await x(p.dataset.productId,B);S.success?(u.textContent=B,q(S.cartCount,S.grandTotal),B>=m&&(l.disabled=!0,T(r,`Stok tersisa ${m}`))):(u.textContent=y,customAlert(S.message||"Gagal memperbarui item.","danger","Error"))}catch(S){console.error("Cart action failed:",S),u.textContent=y,alert("Terjadi kesalahan jaringan. Gagal memperbarui item.")}finally{parseInt(u.textContent)<m&&(l.disabled=!1)}}else if(i){i.disabled=!0;const m=i.closest(".product-card").querySelector(".inline-stock-feedback");m&&m.classList.remove("show");const p=i.closest(".quantity-selector-inline"),u=p.dataset.productId,y=p.querySelector(".quantity-inline-display");let B=parseInt(y.textContent);const S=p.querySelector(".btn-increase-inline");S&&(S.disabled=!1);let O=B-1;y.textContent="...";try{if(O>0){const g=await x(u,O);g.success?(y.textContent=O,q(g.cartCount,g.grandTotal)):(y.textContent=B,customAlert(g.message||"Gagal memperbarui item.","danger","Error"))}else{const g=await oe(u);g.success?(e(u,0),q(g.cartCount,g.grandTotal)):(y.textContent=B,customAlert(g.message||"Gagal menghapus item.","danger","Error"))}}catch(g){console.error("Cart action failed:",g),y.textContent=B,alert("Terjadi kesalahan jaringan. Gagal memperbarui item.")}finally{parseInt(y.textContent)>0&&(i.disabled=!1)}}else if(d){const r=d.dataset.productId,p=document.getElementById(`product-card-${r}`).querySelector(".product-name").textContent;ae(r,p,d.dataset.notes)}else f&&(s.stopPropagation(),J(f.dataset.imageUrl))});const n=I.dataset.cartItemCount||0,t=I.dataset.cartTotalPrice||0;q(parseInt(n),parseInt(t)),document.querySelectorAll(".quantity-selector-inline").forEach(s=>{const o=s.closest(".product-card"),a=s.querySelector(".quantity-inline-display");if(o&&a){const c=parseInt(a.textContent),l=parseInt(o.dataset.stock);if(c>=l){const i=o.querySelector(".btn-increase-inline");i&&(i.disabled=!0),T(o,`Stok tersisa ${l}`)}}})}const W=document.getElementById("cart-items-list");if(W){const e=()=>{const n=document.getElementById("grand-total");let t=0;const s=document.querySelectorAll(".cart-item-card-new");s.forEach(c=>{const l=parseFloat(c.dataset.price),i=c.querySelector(".quantity-inline-display");if(!i)return;const d=parseInt(i.textContent),f=l*d;t+=f,c.querySelector(".item-subtotal").textContent="Rp "+f.toLocaleString("id-ID")}),n&&(n.textContent="Rp "+t.toLocaleString("id-ID")),document.getElementById("sidebar-cart-count").textContent=s.length;const o=document.getElementById("empty-cart-message"),a=document.querySelector(".cart-summary-sticky");s.length===0&&o&&(o&&(o.style.display="flex"),a&&(a.style.display="none"))};W.addEventListener("click",async n=>{var l,i;const t=n.target,s=t.closest(".btn-increase-inline"),o=t.closest(".btn-decrease-inline"),a=t.closest(".btn-edit-notes"),c=t.closest(".card-zoom-btn");if(s){const d=s.closest(".cart-item-card-new"),f=parseInt(d.dataset.stock),r=d.querySelector(".quantity-inline-display");let m=parseInt(r.textContent);if(m>=f){const y=s.closest(".quantity-selector-inline");y.classList.add("shake"),setTimeout(()=>y.classList.remove("shake"),500),T(d,`Stok tersisa ${f}`),s.disabled=!0;return}r.textContent=m+1,e();const p=((l=d.querySelector(".item-notes-text"))==null?void 0:l.textContent)||"";(await x(d.dataset.id,r.textContent,p)).success||(r.textContent=m,e(),customAlert("Gagal memperbarui keranjang.","danger","Error"))}else if(o){const d=o.closest(".cart-item-card-new"),f=d.querySelector(".inline-stock-feedback");f&&f.classList.remove("show");const r=d.querySelector(".quantity-inline-display");let m=parseInt(r.textContent)-1;const p=d.querySelector(".btn-increase-inline");if(p&&(p.disabled=!1),r.textContent="...",m>0){r.textContent=m,e();const u=((i=d.querySelector(".item-notes-text"))==null?void 0:i.textContent)||"";await x(d.dataset.id,m,u)}else{d.style.transition="opacity 0.3s ease",d.style.opacity="0";const u=await oe(d.dataset.id);u.success?setTimeout(()=>{d.remove(),e(),q(u.cartCount,u.grandTotal)},300):(d.style.opacity="1",customAlert("Gagal menghapus item.","danger","Error"))}}else if(a){const d=a.dataset.productId,r=document.getElementById(`cart-item-${d}`).querySelector(".item-name").textContent;ae(d,r,a.dataset.notes)}else c&&(n.stopPropagation(),J(c.dataset.imageUrl))}),W.addEventListener("change",async n=>{const t=n.target;if(t.classList.contains("bungkus-checkbox")||t.classList.contains("option-checkbox")){const s=t.closest(".cart-item-card-new");if(!s)return;const o=s.dataset.id,a=s.querySelector(".quantity-inline-display").textContent,c=s.querySelector(".btn-edit-notes");let l=c?c.dataset.notes:"";const i=`(${t.dataset.option})`;let d="";if(l=l.replace(i,"").trim(),t.checked?d=l?`${i} ${l}`:i:d=l,(await x(o,a,d)).success){const r=s.querySelector(".item-notes-text");r&&(r.textContent=d||"Tidak Ada Catatan"),c&&(c.dataset.notes=d)}else t.checked=!t.checked,customAlert("Gagal memperbarui opsi.","danger","Error")}}),document.querySelectorAll(".cart-item-card-new").forEach(n=>{const t=n.querySelector(".quantity-inline-display");if(!t)return;const s=parseInt(n.dataset.stock);if(parseInt(t.textContent)>=s){const a=n.querySelector(".btn-increase-inline");a&&(a.disabled=!0),T(n,`Stok tersisa ${s}`)}}),window.addEventListener("pageshow",function(n){n.persisted&&window.location.reload()})}const A=document.getElementById("callWaiterModal");if(A){const e=A.querySelector(".modal-close"),n=document.getElementById("callWaiterForm"),t=()=>{A.style.display="flex"},s=()=>{n&&n.reset(),A.style.display="none"};document.body.addEventListener("click",function(o){(o.target.matches(".call-waiter-btn")||o.target.closest(".call-waiter-btn"))&&(o.preventDefault(),t())}),e&&e.addEventListener("click",s),A.addEventListener("click",o=>{o.target===A&&s()}),n&&n.addEventListener("submit",function(o){o.preventDefault();const a=new FormData(this),c=document.querySelector('meta[name="csrf-token"]').getAttribute("content");fetch(appConfig.routes.callWaiterStore,{method:"POST",headers:{"X-CSRF-TOKEN":c,Accept:"application/json"},body:a}).then(l=>l.json()).then(l=>{l.message?(customAlert(l.message,"success","Berhasil"),s()):l.error&&customAlert("Error: "+l.error,"danger","Error")}).catch(l=>console.error("Error:",l))})}const Se=document.querySelectorAll(".product-card"),N=document.getElementById("categoryFilterDropdown");N&&N.addEventListener("change",function(){const e=this.value,n=k?k.value.toLowerCase():"";ce(e,n)}),k&&k.addEventListener("keyup",function(){const e=this.value.toLowerCase(),n=N?N.value:"all";ce(n,e)});function ce(e,n){Se.forEach(t=>{const s=(t.dataset.productName||"").toLowerCase(),o=t.dataset.categoryId,a=e==="all"||o===e,c=s.includes(n);a&&c?t.style.display="flex":t.style.display="none"})}const le=document.querySelector(".cart-summary-sticky"),re=document.querySelector(".cart-page-container");if(le&&re){const e=le.offsetHeight;re.style.paddingBottom=e+20+"px",console.log(`Sticky footer height detected: ${e}px. Padding bottom applied.`)}const ie=document.querySelector(".status-page-actions"),de=document.querySelector(".order-status-page-container");if(ie&&de){const e=ie.offsetHeight;de.style.paddingBottom=`${e+20}px`}const ue=document.getElementById("checkout-form");if(ue&&ue.addEventListener("submit",function(e){e.preventDefault();const n=this.querySelector(".btn-checkout");n.textContent="Memproses Pesanan...",n.disabled=!0;const t=new FormData(this);fetch(this.action,{method:"POST",headers:{"X-CSRF-TOKEN":j,Accept:"application/json"},body:t}).then(s=>s.json()).then(s=>{s.success?window.location.href=s.redirect_url:(customAlert(s.message||"Terjadi kesalahan saat memproses pesanan.","danger","Error"),n.textContent="Kirim Orderan",n.disabled=!1)}).catch(s=>{console.error("Checkout Error:",s),customAlert("Terjadi kesalahan teknis. Silakan coba lagi.","danger","Error Teknis"),n.textContent="Kirim Orderan",n.disabled=!1})}),typeof window.Echo<"u"&&typeof appConfig<"u"){console.log("Listening for product stock updates..."),window.Echo.channel("products").listen("ProductStockUpdated",n=>{console.log("ProductStockUpdated event received!",n);const t=document.getElementById(`product-card-${n.productId}`);if(!t)return;t.dataset.stock=n.newStock,t.dataset.isAvailable=n.isAvailable;const s=t.querySelector(".out-of-stock-overlay"),o=t.querySelector(".quantity-inline-display"),a=t.querySelector(".btn-increase-inline"),c=t.querySelector(".btn-add-cart-initial");if(!n.isAvailable)s&&(s.style.display="flex"),a&&(a.disabled=!0),c&&(c.disabled=!0);else if(s&&(s.style.display="none"),o){const l=parseInt(o.textContent);a&&l<n.newStock&&(a.disabled=!1)}else c&&(c.disabled=!1)});const e=document.getElementById("dining_table_id");if(e){console.log("Login page detected. Listening for table status updates...");const n=()=>{fetch(appConfig.routes.getAvailableTables).then(t=>t.text()).then(t=>{e.innerHTML=t,console.log("Table dropdown updated via real-time.")})};window.Echo.channel("tables-status").listen("AvailableTablesUpdated",t=>{console.log("AvailableTablesUpdated event received!",t),n()})}}if(typeof window.Echo<"u"&&appConfig.sessionId){const e=`customer-logout.${appConfig.sessionId}`;console.log(`Listening for logout signal on public channel: ${e}`),window.Echo.channel(e).listen("SessionCleared",n=>{console.log("Logout signal received from admin!",n),customAlert("Sesi Anda untuk meja ini telah dihentikan oleh admin. Anda akan dikembalikan ke halaman login.","warning","Sesi Dihentikan");const t=document.getElementById("logout-form");t?t.submit():window.location.href="/"})}if(typeof appConfig<"u"&&appConfig.loginTimestamp!==null){const e=appConfig.sessionLifetime,n=appConfig.loginTimestamp,t=appConfig.tableId,o=setInterval(()=>{Math.floor(Date.now()/1e3)-n>=e&&(clearInterval(o),customAlert("Sesi Anda telah berakhir. Anda akan di-logout.","warning","Sesi Berakhir"),t?window.location.href=`/logout/${t}`:window.location.href="{{ route('customer.logout') }}")},3e4)}if(document.querySelector(".order-status-page-container")&&typeof window.Echo<"u"){const e=document.querySelector("[data-order-session-id], [data-call-session-id]");if(e){const n=e.dataset.orderSessionId||e.dataset.callSessionId,t=`order-status.${n}`;console.log(`Listening for order events on: ${t}`),window.Echo.channel(t).listen("OrderStatusUpdated",o=>{console.log("Order status updated!",o.order);const a=document.getElementById(`order-status-badge-${o.order.id}`);a&&(a.textContent=o.order.translated_status,a.className=`status-badge status-${o.order.status}`)});const s=`customer-session.${n}`;console.log(`Listening for call events on: ${s}`),window.Echo.channel(s).listen(".call-received",o=>{console.log("New call data received (CallReceived event)!",o.call);const a=document.querySelector(".order-list"),c=document.querySelector(".empty-status");if(a){c&&(c.style.display="none");const l=document.createElement("div");l.className="status-card call-card",l.dataset.callSessionId=o.call.session_id;const i=new Date(o.call.created_at).toLocaleString("id-ID",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),d=o.call.translated_status||(o.call.status==="pending"?"Menunggu":o.call.status==="handled"?"Ditangani":"Selesai");l.innerHTML=`
                            <div class="receipt-details">
                                <div class="receipt-header">
                                    <h3>Rincian Panggilan #${o.call.call_number}</h3>
                                    <div class="receipt-customer-info">
                                        <span><strong>Waktu:</strong> ${i}</span>
                                        <p class="receipt-status">
                                            <strong>Status:</strong>
                                            <span id="call-status-badge-${o.call.call_number}" class="status-badge status-${o.call.status}">
                                                ${d}
                                            </span>
                                        </p>
                                    </div>
                                </div>
                                <table class="receipt-table">
                                    <tbody>
                                        <tr>
                                            <td>
                                                <div class="item-name">
                                                    <i class="fas fa-comment-dots" style="margin-right: 0.5rem; color: var(--text-muted);"></i>
                                                    Catatan Panggilan
                                                </div>
                                                <div class="receipt-item-notes">
                                                    ${o.call.notes||"Tidak ada catatan khusus."}
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        `,a.prepend(l)}}).listen(".call-status-updated",o=>{console.log("Call status updated received (CallStatusUpdated event)!",o);const a=o.callNumber,c=o.newStatus,l=o.translatedStatus,i=document.getElementById(`call-status-badge-${a}`);i&&(i.textContent=l,i.classList.remove("status-pending","status-handled","status-completed"),i.classList.add(`status-${c}`),i.classList.add("status-updated-highlight"),setTimeout(()=>{i.classList.remove("status-updated-highlight")},2e3))})}}});
